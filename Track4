
hed to the foot. ZUPTs were first used in the NavShoe project by Foxlin5, who reported good results in 2005. ZUPTs are easily incorporated into the INS structure by formulating them as pseudo- measurements of zero velocity. The application of ZUPTs means that open loop integrations only occur during the swing phase of the foot to which the sensor is attached. For such short durations, drift accrual is limited and longer tracking durations are thus feasible. For a reliable output, however, ZUPTs must only be applied when the foot (and hence sensor) is completely static. Issues can arise when the sensor is attached any higher than the ball of the foot. The peeling motion associated with the transition from stance to swing means the heel rises soon after the foot-down event and hence a sensor in the mid-foot will start experiencing an acceleration as the foot levers up. These small accelerations occur before the strict end of the stance phase and it is necessary to account for these errors by applying a non-zero covariance alongside the ZUPT pseudo-measurement.
　Zero velocity update (ZUPT) utilizes a velocity correction based on the observation that the velocity is zero in theory when the foot stays on the ground. PINS based on the zero-velocity correction was designed, and it has been proven to suppress the cubic-in-time position drift to a lower order of error. The classic zero-velocity update algorithm (Zero-velocity update (ZUPT)) based foot-mounted pedestrian dead reckoning consists of a strap-down inertial navigation algorithm, a stance phase detection algorithm, and an error state Kalman filter. However, the ZUPT still has systematic errors mainly because the zero-velocity phase is hard to identify precisely and the actual velocity is small but not zero due to the jitter of the MIMU, especially when the walking velocity increases. The heading misalignment angle is unobserved in ZUPT, and this will lead a further position error due to the continuous increase of the heading error. In addition, the classic ZUPT-based Foot-PDR cannot overcome the influence of the complex motion of the pedestrian.
　CUPT cannot perform well in situations with consistent velocity, such as in an elevator or on an escalator. This is due to the fact that they detect the cases with constant velocity as zero velocity. We proposes an improved shoe-mounted PINS system, and a new algorithm named Constant Velocity Update (CUPT) can detect not only the stance phases as ZUPT, but also constant velocity when a user is standing in an elevator or on an escalator. In principle, all the instants that are correctly detected can be applied to EKF estimated error states correction, including but not limited to zero velocity. Here constant velocity is tackled; Therefore, the algorithm is called CUPT. The proposed algorithm can detect the stance phases as ZUPT when stepping on the ground, and also the constant velocity when standing in a moving elevator or on a moving escalator. ZUPT is just a special case in CUPT when the true velocity condition is exactly zero. If a ZUPT algorithm is applied to test the cases with constant velocity, it will regard the constant velocity as zero velocity and perform ZUPT. As the result, the navigation solution is obviously wrong. The core concept of CUPT algorithm is to detect the velocity of the standing platform and use it to correct INS drift. Obviously, without considering the velocity condition, the constant velocity phases satisfy all the conditions for zero velocity stance phases. CUPT needs to identify not only a stance phase, but also the velocity during the stance phase, and whether the velocity is constant or not.
　The core of our algorithm is the strap-down inertial navigation algorithm. On this basis, a zero-velocity detection method with adaptive threshold setting is used to adapt to different motions. An improved adaptive threshold is used instead of the fixed threshold method to detect the stance-phase in each gait cycle. The adaptive threshold method is adaptable to different gait frequencies in dynamic motion. Once the stance phase is detected, a zero-velocity vector is used to estimate and correct the navigation error
　Next, the motion pattern recognition algorithm is used to distinguish whether the user is walking normally, going up/down stairs, or taking the escalator and elevator. The most influential metrics are the velocity, and acceleration data characteristics of the foot-mounted IMU. Then we use CUPT, ZUPT, Zero Angular Rate Update (ZARU), heuristic drift elimination (HDE). The HDE algorithm is a very useful method to constraint the system’s heading drift, if the indoor reference heading can be known in advance. The initial heading is used to calculate several possible reference directions of pedestrian walking. Then, the closest reference direction is used to calculate the estimate position at the current footstep, then uses the position error between the estimate position and the inertia recursive position to restrain the position divergence.
　Height divergence is a major problem in Inertial Navigation System (INS)-based foot-mounted PDR system in multi-story positioning. If a pedestrian is walking on a plane, the slope of the current stride is approximately zero degree, if that, keep the height always unchanged. While walking on a staircase, the method proposed uses the actual slope of the stairs (usually 20 45 degrees) to calculate the height change of the current stride, which can be used to constrain the height divergence of the current stride. If pedestrian is on an elevator or escalator, it mainly can be effectively determined by analyzing the characteristics of acceleration, especially the acceleration in the vertical direction. So, the linear trajectory and height constraints to improve the position estimation accuracy according to the discrimination results. And when the user comes to an outdoor scene, the GNSS signal will be used to improve the positioning performance.
